name: Demo CI/CD

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test-demos:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        demo-category: [simple, containerized]
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      if: matrix.demo-category == 'simple'
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Setup Python
      if: matrix.demo-category == 'containerized'
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies and test
      run: |
        find . -path "./${{ matrix.demo-category }}/*" -name "package.json" -execdir npm install \; || true
        find . -path "./${{ matrix.demo-category }}/*" -name "requirements.txt" -execdir pip install -r {} \; || true
        
    - name: Run linting
      run: |
        find . -path "./${{ matrix.demo-category }}/*" -name "*.js" -o -name "*.ts" | head -10 | xargs -r npm run lint 2>/dev/null || true
        find . -path "./${{ matrix.demo-category }}/*" -name "*.py" | head -10 | xargs -r flake8 2>/dev/null || true